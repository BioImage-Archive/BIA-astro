---
const { image } = Astro.props;
---
<article class="vf-card vf-card--brand vf-card--bordered custom-card" style="max-width:400px">
    <div class="vf-card__content | vf-stack vf-stack--400">
        <h3 class="vf-card__heading title-container">
            <div class="title-text">{ image.label }</div>
        </h3>
        <p class="vf-card__text">
            <a href={"/dataset/" + image.submitted_in_study_accession}>{ image.submitted_in_study_accession }</a>
        </p>
    </div>
    <div class="image-container">
        <img src={ image.thumbnail_src } alt="" class="vf-card__image" loading="lazy" style="aspect-ratio: 1/1;">
        <div class="size-bar">
            <span class="physical-size">
                <code>{ Number(image.physical_dim_x * 1e6).toPrecision(2) }<span class="x-text">×</span>{ Number(image.physical_dim_y * 1e6).toPrecision(2) }<span class="x-text">×</span>{ Number(image.physical_dim_z * 1e6).toPrecision(2) }</code><span class="unit-text"> µm</span>
            </span>
            <span class="image-size">
                <code>{ image.size_x }<span class="x-text">×</span>{ image.size_y }<span class="x-text">×</span>{ image.size_z }</code><span class="unit-text"> vx</span>
            </span>
            <span class="voxel-size">
                <code>{ Math.round(image.voxel_size_x * 1e9) }<span class="x-text">×</span>{ Math.round(image.voxel_size_y * 1e9) }<span class="x-text">×</span>{ Math.round(image.voxel_size_z * 1e9) }</code><span class="unit-text"> nm voxels</span>
            </span>
        </div>
    </div>
    <div class="vf-card__content | vf-stack vf-stack--400">
        <p class="vf-card__text">
            <i>{ image.organism }</i>, { image.imaging_method }
        </p>
        <hr>
        <p class="vf-card__text">
            View: 
            <button><a href={ image.view_link }>Neuroglancer</a></button>
            <button><a href={"/bioimage-archive/image/" + image.uuid}>Metadata</a></button>
        </p>
    </div>
</article>

<style>
    .row {
        margin-bottom: 5px;
    }
    button {
        margin: 5px;
    }
    .title-container {
        height: 4.5em;  /* Approximately 3 lines of text */
        margin: 0;
        overflow: hidden;
    }
    .title-text {
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    .image-container {
        width: 100%;
        overflow: hidden;
        position: relative;
    }
    .size-bar {
        position: absolute;
        bottom: 10px;
        left: 10px;
        background: rgba(243, 243, 243, 0.9);
        padding: 8px 12px;
        font-size: 0.9em;
        display: flex;
        flex-direction: column;
        gap: 4px;
        border-radius: 4px;
        max-width: 80%;
    }
    .physical-size, .image-size, .voxel-size {
        min-width: 0;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    .x-text {
        font-size: 0.8em;
        vertical-align: middle;
        color: #666;
    }
    .unit-text {
        font-size: 0.8em;
        color: #666;
    }
    .custom-card {
        border: 2px solid #999;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.15);
        transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
    }
    .custom-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.25);
    }

    .cube-wrapper {
        width: 40px;
        height: 40px;
        perspective: 120px;
        position: absolute;
        bottom: 10px;
        right: 10px;
        background: rgba(243, 243, 243, 0.9);
        padding: 8px;
        border-radius: 4px;
    }

    .cube {
        width: 100%;
        height: 100%;
        position: relative;
        transform-style: preserve-3d;
        transform: translateZ(-15px) rotateX(-20deg) rotateY(-45deg);
    }

    .cube__face {
        position: absolute;
        width: 30px;
        height: 30px;
        border: 1px solid rgba(0, 0, 0, 0.3);
        background: rgba(200, 200, 200, 0.2);
    }

    .cube__face--front  { transform: rotateY(0deg) translateZ(calc(15px * var(--scale-z))); }
    .cube__face--right  { transform: rotateY(90deg) translateZ(calc(15px * var(--scale-x))); }
    .cube__face--back   { transform: rotateY(180deg) translateZ(calc(15px * var(--scale-z))); }
    .cube__face--left   { transform: rotateY(-90deg) translateZ(calc(15px * var(--scale-x))); }
    .cube__face--top    { transform: rotateX(90deg) translateZ(calc(15px * var(--scale-y))); }
    .cube__face--bottom { transform: rotateX(-90deg) translateZ(calc(15px * var(--scale-y))); }
</style>
