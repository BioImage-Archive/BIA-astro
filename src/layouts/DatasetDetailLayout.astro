---
//import field_map from "../data/field-names-mapping.json";

const { data, field_map } = Astro.props;
function taxon_render(taxon) {
    //TODO: deal with partial information better, as well as link out to NCBI taxon
   
    var string_text = "help test"
    if (taxon["common_name"] & taxon["scientific_name"]){
        string_text = taxon["common_name"].concat(" (<i>", taxon["scientific_name"] , "</i>)")
    } else if (taxon["common_name"]) {
        string_text = taxon["common_name"]
    } else if (taxon["scientific_name"]) {
        string_text = "<i>".concat(taxon["scientific_name"], "</i>")
    }
    if (taxon["ncbi_id"]) {
        return `<li class="vf-content"> <a href=\"https://www.ncbi.nlm.nih.gov/Taxonomy/Browser/wwwtax.cgi?id=${taxon["ncbi_id"]}\"">${string_text}</a></li>`;
    } else {
        return `<li class="vf-content"> ${string_text}</li>`;
    }
}

function render_value(key, value) {
    if (key === "organism_classification") {
        return `<ul>
            ${value.map((taxon) => taxon_render(taxon)).join("")} 
            </ul>`;
    } else {
        return value;
    }
}

const render_field = Object.keys(data).map((key) => {
    if (key in field_map && !(data[key] == null)) {
        return `<div><b>${field_map[key]}:</b>&nbsp; ${render_value(key, data[key])}</div>`;
    }
});

//TODO: set this on a per-section basis
const is_open = "True"
---

<details open={is_open}>
    <summary>
        <b>{data.title_id}</b>
    </summary>

    <ul>
        <Fragment set:html={render_field} ` />
    </ul>
</details>
