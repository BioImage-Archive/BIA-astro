---
title: Downloading data
layout: ../../layouts/HelpLayout.astro

---
import s3_image_uri from "/src/assets/bioimage-archive/accessing_s3_image_uri.png" ;


## Downloading data

Data of submission in the BioImage Archive can be downloaded via web browser, ftp or Aspera.  All three methods are explained below. We recommend ftp or Aspera for large download sizes.

### Downloading via web browser

Data of a submission can be downloaded via a web browser. First, go to the web page of the specific submission you want to download. Select individual files you like and download by clicking the download button. Otherwise, use the “Download all files” button without selecting any files.

You can also download files that belong to a particular study component of a submission.

### Downloading via ftp

The BioImage Archive FTP path is `ftp://ftp.ebi.ac.uk/biostudies`. Anonymous downloads are enabled. For each study, you can click on the FTP button to access it. 

You can also use your favourite FTP client such as FileZilla to download a study from `ftp://ftp.ebi.ac.uk/biostudies/<mode>/<path>`, where:


`<mode>` is the storage mode and can be either fire or nfs

`<path>` is the path of the accession as described above

You can get the FTP link for a study from the /info REST API endpoint, e.g.,
```
    $ curl https://www.ebi.ac.uk/biostudies/api/v1/studies/S-BIAD570/info -s \| jq -r .ftpLink
```
All data files for a study are in the `ftp://ftp.ebi.ac.uk/biostudies/<mode>/<path>/Files` directory, e.g., to download the file STAN0B0F6_2022-02-25.tiff from S-BIAD570, you can use the command line
```
    $ wget ftp://ftp.ebi.ac.uk/biostudies/fire/S-BIAD/570/S-BIAD570/Files/STAN0B0F6_2022-02-25.tiff
```
or, for interactive access:
```
    $ ftp ftp.ebi.ac.uk Name: anonymous ftp> cd biostudies/fire/S-BIAD/570/S-BIAD570/Files/ ftp> get STAN0B0F6_2022-02-25.tiff 
```
### Downloading data via Aspera
When downloading large volumes of data, the Aspera protocol can be useful. The information in the section is based on [how to transfer files to and from EMBL](https://embl.service-now.com/kb?id=kb_article_view&sys_kb_id=21320fd5c3b8ba10bf313dfc05013146#OPTION-3---ASCP-BINARY--What-You-Need).

The steps required to use the *ascp* tool are:

1. **Get the *ascp* command line binary.**
   - Download the appropriate aspera transfer sdk for your operating system from: [Aspera Transfer SDK - IBM API Hub - IBM Developer](https://developer.ibm.com/apis/catalog/aspera--aspera-transfer-sdk/downloads/downloads.json)
   - Unzip/untar into a suitable directory, for example, `C:\aspera` on Windows or `/opt/aspera` on Linux
   - Navigate to the `aspera/bin` directory. This is the location where you will find the *ascp* binary.

2. **Get the Public SSH key for use with EMBL-EBI Aspera public account IBM Aspera transfers**.

   To use IBM Aspera for downloading public data from EMBL-EBI, you will need the correct private SSH key for authentication. This key has to be saved in a file on your computer and the path to this file will be needed when running the *ascp* command. The file must have restrictive permissions that allow only the current user to access it. On \*nix platforms this is equivalent to mode *0600*.

   The key is available for download [here](https://drive.google.com/drive/folders/1ZQcGVM0JxvTavjIU-4Ils1sN759BQEA1?usp=sharing) and also below:

   ```
   -----BEGIN OPENSSH PRIVATE KEY-----
   b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZW
   QyNTUxOQAAACAn56FmhbC61KwdCOgiHbyDhYo1JV5LIxaN8XksrUB4UAAAAKg7YRgnO2EY
   JwAAAAtzc2gtZWQyNTUxOQAAACAn56FmhbC61KwdCOgiHbyDhYo1JV5LIxaN8XksrUB4UA
   AAAEAgc79aAbfysxJRwJHSlyNOpNhRgKQApCAc1uYoxTtBuyfnoWaFsLrUrB0I6CIdvIOF
   ijUlXksjFo3xeSytQHhQAAAAIXJvb3RAdHJhbnNmZXJzZXJ2ZXIubXloaXNwZWVkLmNvbQ
   ECAwQ=
   -----END OPENSSH PRIVATE KEY-----
   ```

   You must save this key to a file on your own machine, e.g. `/home/user/.ssh/aspera-public-private-key.key` with permissions 0600 (on \*nix - `chmod 600 <path to key>`). You will need the path to this key when executing the *ascp* command.

3. **Get the path to the file(s) you want to download.**
   - Get the common root for all files in the study:
     ```
     curl https://www.ebi.ac.uk/biostudies/api/v1/studies/<accession id>/info -s | jq -r .ftpLink | sed 's#ftp://ftp.ebi.ac.uk##g'
     ```
     e.g. for S-BIAD2119:
     ```
     curl https://www.ebi.ac.uk/biostudies/api/v1/studies/S-BIAD2119/info -s | jq -r .ftpLink | sed 's#ftp://ftp.ebi.ac.uk##g'
     ```
   - Get the relative path to individual files from the file list of the relevant study component of the study.
   - Form the path for a file by
     ```
     <common root>/Files/<relative path to individual file>
     ```
     e.g.
     ```
     /pub/databases/biostudies/S-BIAD/119/S-BIAD2119/Files/microscopy_image/microscopy_image/TH_sympathetic_nerve/sample1/slice_0000.tif
     ```

     The example above comes from a study on 'nfs' at the time of writing. If the study is on 'fire' (our FIle REplication service), the path will be of the form
     ```
     /biostudies/fire/S-BIAD/570/S-BIAD570/Files/STAN0B0F6_2022-02-25.tiff
     ```

     Following the steps above should give the correct path regardless of whether the study is on nfs or fire.

4. **Download the file(s)**.

   Assuming you are in the `aspera/bin` directory, your command for download should be like this:

   ```
   ./ascp -P33001 -Q -l 300M -i <key> fasp-public@fasp.ebi.ac.uk:<file to download> <download location on your machine>
   ```

   Where
   - `-P33001` and `fasp-public@fasp-beta.ebi.ac.uk` define the port, user and server for the Aspera connection.
   - `<key>` is the path to the public key for use with the EMBL-EBI Aspera connection (see subsection above).
   - `<file to download>` is the remote download path (see subsection above).
   - `-Q` enables quiet mode suppressing progress output and logs, so the command runs more silently.
   - `-l 300M` sets the target transfer rate limit to 300 megabits per second.

   For instance, here's the command line to download the file `microscopy_image/microscopy_image/TH_sympathetic_nerve/sample1/slice_0000.tif` from submission S-BIAD2119 to the directory `~/temp` on linux:
   ```
   ./ascp -P33001 -Q -l 300M -i ~/.ssh/aspera-public-private-key.key fasp-public@fasp.ebi.ac.uk:/pub/databases/biostudies/S-BIAD/119/S-BIAD2119/Files/microscopy_image/microscopy_image/TH_sympathetic_nerve/sample1/slice_0000.tif  ~/temp/
   ```

### Downloading data using Globus

The BioImage Archive supports file downloads through Globus as well. You can click on the Globus icon to open up the [EMBL-EBI Public Data collection](https://app.globus.org/file-manager?origin_id=47772002-3e5b-4fd3-b97c-18cee38d6df2&origin_path=%2Fbiostudies%2F) in the Globus File Manager app. You may want to install [Globus Connect Personal](https://www.globus.org/globus-connect-personal) which creates a personal collection on your machine for [transferring multiple files](https://docs.globus.org/how-to/get-started/).

<h3 id="aws_client_download">Downloading data with the AWS client </h3>

It is possible to access the datasets through any tool that can read from S3. We recommend using the AWS command line interface.
The S3 uri of the ome-ngff images can be found by clicking on the “Copy S3 uri to clipboard” button on the image webpage.

<figure class="center margin-bottom-large margin-right-large" style="width: 550px">
  <img src={s3_image_uri.src} alt="Screenshot of an image page on the BIA website, highlighting the 'Copy OME-Zarr URI' button to the left of the image"/>
</figure>

The first part of the s3 uri, starting with https is the s3 endpoint, and the rest is the s3 path of the image. When run from the command line, this command lists the contents of the ome-ngff image folder:
```
    aws --endpoint-url https://uk1s3.embassy.ebi.ac.uk s3 ls s3://bia-integrator-data/S-BIAD463/00cddbf9-1282-4a49-94d9-481b7a43cc0c/00cddbf9-1282-4a49-94d9-481b7a43cc0c.zarr/ --no-sign-request
```        
The AWS client can also copy data from S3 to local storage. Detailed instructions for using this tool can be found in the [AWS user guide](https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-welcome.html).
