---
import BaseLayout from '../../layouts/BaseLayout.astro';
import VolumeEMImage from '../../components/cards/VolumeEMImage.astro';
import VolumeEMTable from '../../components/VolumeEMTable.astro';
import VolumeEMImageCompact from '../../components/cards/VolumeEMImageCompact.astro';
import vemImages from "../../data/collections/vem_image_summaries.json";
---
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.css" />
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
<script is:inline>
    document.addEventListener('DOMContentLoaded', () => {
        const dataTable = new DataTable('.vf-table', {
            pageLength: 25,
            order: [[1, 'asc']], // Sort by Label column by default
            columnDefs: [
                { orderable: false, targets: [4, 5, 6] } // Disable sorting for dimensions, physical size, and voxel size columns
            ]
        });

        window.toggleView = function() {
            const cardView = document.getElementById('card-view');
            const tableView = document.getElementById('table-view');
            const toggleButton = document.getElementById('view-toggle');
            
            const gridView = document.getElementById('grid-view');
            const currentView = [cardView, tableView, gridView].find(view => view.style.display !== 'none');
            const views = {
                'card-view': { text: 'Switch to Table View', next: 'table-view' },
                'table-view': { text: 'Switch to Grid View', next: 'grid-view' },
                'grid-view': { text: 'Switch to Card View', next: 'card-view' }
            };
            
            const currentId = currentView.id;
            const nextId = views[currentId].next;
            
            [cardView, tableView, gridView].forEach(view => view.style.display = 'none');
            document.getElementById(nextId).style.display = 'block';
            toggleButton.textContent = views[nextId].text;
            
            if (nextId === 'table-view') {
                dataTable.columns.adjust();
            }
        }
    });
</script>
<BaseLayout pageTitle="Volume EM Gallery">
  <body>
    <section class="vf-intro | embl-grid embl-grid--has-centered-content">
        <div></div>
        <div>
            <h1 class="vf-intro__heading vf-intro__heading--has-tag">EMPIAR Volume EM Volumes <a href="JavaScript:Void(0);" class="vf-badge vf-badge--primary vf-badge--phases">alpha</a></h1>
            <h2 class="vf-intro__subheading">Individual volume images across a range of species, vEM imaging methods and reconstruction approaches. Each volume has background information, and can be viewed in the browser, or accessed remotely.</h2>
            <p></p>
        </div>
        <div></div>
    </section> 
    <div class="view-toggle-container">
        <button id="view-toggle" class="vf-button vf-button--primary" onclick="toggleView()">Switch to Table View</button>
    </div>
    
    <div id="card-view">
        <section class="vf-card-container vf-card-container__col-4 | vf-u-background-color-ui--white vf-u-fullbleed" style="--vf-card__image--aspect-ratio: 16 / 9;">
            <div class="vf-card-container__inner">
                { Object.entries(vemImages).map(([uuid, image]) => (
                    <VolumeEMImage image={{...image, uuid}} />
                ))}
            </div>
        </section>
    </div>

    <div id="table-view" style="display: none;">
        <VolumeEMTable images={vemImages} />
    </div>

    <div id="grid-view" style="display: none;">
        <section class="vf-card-container vf-card-container__col-6 | vf-u-background-color-ui--white vf-u-fullbleed">
            <div class="vf-card-container__inner">
                { Object.entries(vemImages).map(([uuid, image]) => (
                    <VolumeEMImageCompact image={{...image, uuid}} />
                ))}
            </div>
        </section>
    </div>

    <style>
        .view-toggle-container {
            text-align: right;
            padding: 1em;
            margin-right: 1em;
        }
        #view-toggle {
            padding: 0.5em 1em;
            border-radius: 4px;
            cursor: pointer;
        }
    </style>
  </body>
</BaseLayout>
